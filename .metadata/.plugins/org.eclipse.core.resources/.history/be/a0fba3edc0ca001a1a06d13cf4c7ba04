package com.running.train.service;

import java.sql.Date;
import java.time.Instant;
import java.util.List;

import org.springframework.stereotype.Service;

import com.running.train.delegate.RailwayTrainRunningDelegate;
import com.running.train.entities.RunningTrainStatus;
import com.running.train.entities.Trip;
import com.running.train.model.Route;
import com.running.train.model.Status;
import com.running.train.model.Train;
import com.running.train.model.TrainScheduler;
import com.running.train.repository.RailwayTrainRunningRepository;

@Service
public class RailwayTrainRunningService {

	private RailwayTrainRunningRepository railwayTrainRunningRepository;

	private RailwayTrainRunningDelegate railwayTrainRunningDelegate;

	public RailwayTrainRunningService(RailwayTrainRunningRepository railwayTrainRunningRepository,
			RailwayTrainRunningDelegate railwayTrainRunningDelegate) {
		this.railwayTrainRunningRepository = railwayTrainRunningRepository;
		this.railwayTrainRunningDelegate = railwayTrainRunningDelegate;
	}

	public List<RunningTrainStatus> scheduleTrain(TrainScheduler schedular) {
		
		List<Route> fetchedRoutes = railwayTrainRunningDelegate.getListOfRoutes(schedular.getRouteId());
		Train scheduledTrain = railwayTrainRunningDelegate.getTrainById(Long.valueOf(schedular.getTrainNumber()));
		
		//Insert a record into the trip table
		//Identify the route and insert as many records in the running table.
		return null;
	}
	
	private Trip getReadyForTrip(Train train, Route route) {
		Trip  trip = new Trip();
		trip.setDestinationStation(train.getDestinationStationCode());
		trip.setSourceStation(train.getSourceStationCode());
		trip.setJourneyDate(new Date(Instant.now().getEpochSecond()));
		trip.setTripStatus(Status.STARTED);
		return trip;
	}
}
